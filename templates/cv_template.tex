\documentclass[10pt,a4paper]{article}

% ---------------- Packages ----------------
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[\VAR{'english' if lang=='en' else 'french'}]{babel}
\usepackage{geometry}
\usepackage{enumitem}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{titlesec}
\usepackage{tabularx}
\usepackage{graphicx}
\usepackage{fontawesome5}
\usepackage{array}

% ---------------- Page Setup ----------------
\geometry{left=1.2cm,right=1.2cm,top=0.9cm,bottom=1.5cm}
\setlength{\parindent}{0pt}
\setlength{\parskip}{0pt}
\setlength{\emergencystretch}{2em}

% ---------------- Colors ----------------
\definecolor{primary}{HTML}{1F6FB2}
\definecolor{secondary}{HTML}{6B6B6B}

% ---------------- Hyperlinks ----------------
\hypersetup{
  colorlinks=true,
  linkcolor=primary,
  urlcolor=primary,
  citecolor=primary
}

% ---------------- Section Style ----------------
\titleformat{\section}
  {\large\bfseries\color{primary}}
  {}
  {0pt}
  {}
  [\vspace{0.12em}\color{primary}\rule{\linewidth}{0.55pt}]
\titlespacing*{\section}{0pt}{0.55em}{0.15em}

% ---------------- Lists ----------------
\setlist[itemize]{leftmargin=1.15em, itemsep=0.05em, topsep=0pt, parsep=0pt, partopsep=0pt, label=\textbullet}

% ---------------- Helpers ----------------
\newcommand{\muted}[1]{{\color{secondary}#1}}
\newcommand{\blue}[1]{{\color{primary}#1}}
\newcommand{\dotsep}{\hspace{0.55em}\textcolor{secondary}{\large$\cdot$}\hspace{0.55em}}

% ---------------- Document ----------------
\begin{document}
\pagestyle{empty}

% ---------------- Header ----------------
\begin{tabularx}{\textwidth}{@{}p{3.5cm} X@{}}
% Optional photo block; fallback handled in backend, guard anyway
\BLOCK{ if personal_info.photo_path }
\raisebox{-0.8\height}{\includegraphics[width=3.5cm, keepaspectratio]{\VAR{personal_info.photo_path}}} 
\BLOCK{ else }
\textbf{[PHOTO]}
\BLOCK{ endif }
&
\begin{minipage}[t]{\linewidth}
  \vspace*{-1em}
  {\huge\bfseries \blue{\VAR{personal_info.name}}}\\[0.2em]
  {\Large\bfseries \blue{\VAR{personal_info.title}}}\\[0.35em]

  \small
  \blue{\faIcon{envelope}}\hspace{0.35em}\href{mailto:\VAR{personal_info.email}}{\underline{\VAR{personal_info.email}}}
  \dotsep
  \blue{\faIcon{mobile-alt}}\hspace{0.35em}\muted{\VAR{personal_info.phone}}
  \dotsep
  \blue{\faIcon{map-marker-alt}}\hspace{0.35em}\muted{\VAR{personal_info.location}}
\end{minipage}
\end{tabularx}

\vspace{0.8em}

\BLOCK{ if personal_info.summary }
{\small\muted{\VAR{personal_info.summary}}}
\BLOCK{ endif }

% ---------------- Formation (Loop) ----------------
\BLOCK{ if education|length > 0 }
\section{FORMATION - CERTIFICATION}
\vspace{-0.2em}
\begin{tabularx}{\textwidth}{@{}p{3.5cm} X@{}}
\BLOCK{ for edu in education }
\blue{\textbf{\textbullet\ \ \VAR{edu.period}}} &
\textbf{\VAR{edu.degree}}\\[-0.1em]
\muted{\textbf{\ \ \ \VAR{edu.school}}} &
\BLOCK{ if edu.details and edu.details|length > 0 }
\begin{itemize}
    \BLOCK{ for detail in edu.details }
    \item \VAR{detail}
    \BLOCK{ endfor }
\end{itemize}
\BLOCK{ endif }
\\[-0.35em]
\BLOCK{ endfor }
\end{tabularx}
\BLOCK{ endif }

% ---------------- Compétences (Loop) ----------------
\BLOCK{ if skills|length > 0 }
\section{COMPETENCES}
\vspace{-0.35em}
{\small
\begin{itemize}
    \BLOCK{ for skill in skills }
    \item \VAR{skill}
    \BLOCK{ endfor }
\end{itemize}
}
\BLOCK{ endif }

% ---------------- Expériences (Loop) ----------------
\BLOCK{ if experience|length > 0 }
\section{EXPÉRIENCES PROFESSIONNELLES}
\vspace{-0.2em}
\begin{tabularx}{\textwidth}{@{}p{3.5cm} X@{}}
\BLOCK{ for exp in experience }
\blue{\textbf{\textbullet\ \ \VAR{exp.period}}} &
\textbf{\VAR{exp.role}}\\[-0.1em]
\muted{\textbf{\ \ \ \VAR{exp.company}}} &
\BLOCK{ if exp.details and exp.details|length > 0 }
\begin{itemize}
    \BLOCK{ for detail in exp.details }
    \item \VAR{detail}
    \BLOCK{ endfor }
\end{itemize}
\BLOCK{ endif }
\\[-0.35em]
\BLOCK{ endfor }
\end{tabularx}
\BLOCK{ endif }

\end{document}
